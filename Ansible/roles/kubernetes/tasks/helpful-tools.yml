---
- name: "Alias k"
  lineinfile:
    path: /home/kubernetes/.bashrc
    line: "alias k=kubectl"
    regexp: "^alias k=kubectl$"
    state: present

- name: "Block - Autocomplete k"
  block:
    - name: "Autocomplete k"
      lineinfile:
        path: /home/kubernetes/.bashrc
        line: "source <(kubectl completion bash)"
        regexp: "^source <(kubectl completion bash)$"
        state: present

    - name: "Check if Autocomplete for k is installed"
      command: complete -p
      register: collection_specifications

    - name: "Install Autocomplete for k"
      when: not {{ k_bash_completion_command }} in collection_specifications.stdout_lines
      command: "{{ k_bash_completion_command }}"
